<html>
<head>
  <script type="module">
    import { Octokit } from "https://cdn.skypack.dev/@octokit/core";

    var oldusernames;
    var oldmessages;
    
    // getting the current data
    (async () => {
      const data = await fetch('./data.json').then(r => r.json());
      oldusernames = data.data[0];
      oldmessages = data.data[1];
      
      oldusernames = JSON.stringify(oldusernames);
      oldmessages = JSON.stringify(oldmessages);
      
      oldusernames = oldusernames.replace('{"name":"','');
      oldusernames = oldusernames.replace('"}','');
      oldmessages = oldmessages.replace('{"message":"','');
      oldmessages = oldmessages.replace('"}','');
    })();

    // ?name=skparab1&message=t
    var loc = window.location.href; //get the url
    var data;
    data = loc.replace('https://skparab1.github.io/sendmsg?',''); //extract the metadata
    data = data.replace('file:///Users/homemac/Desktop/Programming/Other%20programs/server/ui/sender.html?',''); // this is for test
    data = data.split('&');
    var username = data[0].replace('name=','');
    var message = data[1].replace('message=','');

          
    sendusernames = oldusernames + '&nextentry&' + username;
    sendmessages = oldmessages + '&nextentry&' + message;
    
    const octokit = new Octokit({ auth: "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" }); // you shouldnt hardcode this
    octokit.request('GET /repos/:owner/:repo', {
      owner: "skparab1",
      repo: "server"
    }).then(response => console.log(response.data))
    async function start() {
      return await octokit.request('POST /repos/skparab1/server/issues', {
          owner: 'skparab1',
          repo: 'server',
          title: sendusernames,
          body: sendmessages,
          tags: 'serverdata'
        })
    };
    
    //start();

    //var redirect = setTimeout(window.open('https://skparab1.github.io/ui',"_self")[3000]);
  </script>    
</head>

<body>

  <h1>Sending ur message...</h1>

</body>
</html>
